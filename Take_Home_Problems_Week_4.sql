--Take Home Problems Week 4
--Rushali Moteria

CREATE TABLE SALES (
    Date DATE,
    Order_id INT,
    Item_id INT,
    Customer_id INT,
    Quantity INT,
    Revenue DECIMAL(10, 2)
);


CREATE TABLE ITEMS (
    Item_id INT,
    Item_name VARCHAR(50),
    Price DECIMAL(10, 2),
    Department VARCHAR(50)
);


CREATE TABLE CUSTOMERS (
    Customer_id INT,
    First_name VARCHAR(50),
    Last_name VARCHAR(50),
    Address VARCHAR(100)
);


INSERT INTO SALES (Date, Order_id, Item_id, Customer_id, Quantity, Revenue) VALUES
('2023-03-18', 1, 101, 1, 2, 50),
('2023-03-18', 2, 102, 2, 1, 30),
('2023-01-15', 3, 103, 1, 3, 90),
('2023-03-18', 4, 104, 3, 5, 150),
('2022-12-12', 5, 105, 2, 4, 40),
('2022-08-01', 6, 106, 3, 1, 20),
('2023-01-30', 7, 107, 4, 2, 100),
('2022-05-10', 8, 108, 5, 1, 50);


INSERT INTO ITEMS (Item_id, Item_name, Price, Department) VALUES
(101, 'Product A', 25, 'Electronics'),
(102, 'Product B', 30, 'Clothing'),
(103, 'Product C', 30, 'Groceries'),
(104, 'Product D', 50, 'Electronics'),
(105, 'Product E', 10, 'Clothing'),
(106, 'Product F', 20, 'Groceries'),
(107, 'Product G', 50, 'Electronics'),
(108, 'Product H', 50, 'Home');


INSERT INTO CUSTOMERS (Customer_id, First_name, Last_name, Address) VALUES
(1, 'John', 'Doe', '123 Elm St'),
(2, 'Jane', 'Smith', '456 Maple St'),
(3, 'John', 'Doe', '789 Oak St'),
(4, 'Michael', 'Johnson', '101 Pine St'),
(5, 'Doe', 'Moe', '202 Birch St');


-- Pull total number of orders that were completed on 18th March 2023
SELECT COUNT(Order_id) AS Total_Orders
FROM SALES
WHERE Date = '2023-03-18';

-- Pull total number of orders that were completed on 18th March 2023 with the first name ‘John’ and last name Doe’
SELECT COUNT(SALES.Order_id) AS Total_Orders
FROM SALES
JOIN CUSTOMERS ON SALES.Customer_id = CUSTOMERS.Customer_id
WHERE SALES.Date = '2023-03-18' AND CUSTOMERS.First_name = 'John' AND CUSTOMERS.Last_name = 'Doe';

-- Pull total number of customers that purchased in January 2023 and the average amount spend per customer
SELECT COUNT(DISTINCT Customer_id) AS Total_Customers,
       AVG(Revenue) AS Avg_Spend_Per_Customer
FROM SALES
WHERE Date BETWEEN '2023-01-01' AND '2023-01-31';

-- Pull the departments that generated less than $600 in 2022
SELECT ITEMS.Department, SUM(SALES.Revenue) AS Total_Revenue
FROM SALES
JOIN ITEMS ON SALES.Item_id = ITEMS.Item_id
WHERE YEAR(SALES.Date) = 2022
GROUP BY ITEMS.Department
HAVING SUM(SALES.Revenue) < 600;

-- What is the most and least revenue we have generated by an order
SELECT MAX(Revenue) AS Most_Revenue, MIN(Revenue) AS Least_Revenue
FROM SALES;

-- What were the orders that were purchased in our most lucrative order
WITH Max_Revenue AS (
    SELECT MAX(Revenue) AS Most_Revenue
    FROM SALES
)
SELECT SALES.Order_id, SALES.Revenue
FROM SALES, Max_Revenue
WHERE SALES.Revenue = Max_Revenue.Most_Revenue;
